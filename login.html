<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
</head>
<body>
<h1>تسجيل الدخول</h1>
<input type="text" id="username" placeholder="اسم المستخدم"><br><br>
<input type="password" id="password" placeholder="كلمة المرور"><br><br>
<button onclick="login()">دخول</button>

<script>
// إعدادات Firebase من ملفك
const firebaseConfig = {
    apiKey: "AIzaSyB7KCJpm8S2kA0OStfd8utJqs1FdgOXLoc",
    authDomain: "password-a409.firebaseapp.com",
    databaseURL: "https://password-a409-default-rtdb.firebaseio.com",
    projectId: "password-a409",
    storageBucket: "password-a409.firebasestorage.app",
    messagingSenderId: "883669716957",
    appId: "1:883669716957:android:51306477ae67104f497034"
};

// تهيئة Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function login() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    const userRef = db.ref("Users/" + username);
    userRef.once("value").then(snapshot => {
        if (!snapshot.exists()) {
            alert("المستخدم غير موجود");
            return;
        }

        const data = snapshot.val();
        const now = Date.now();

        // تحقق من الحظر
        if (now < (data.blockedUntil || 0)) {
            alert("أنت محظور حتى " + new Date(data.blockedUntil));
            return;
        }

        // كلمة المرور صحيحة
        if (data.password === password) {
            userRef.update({ loginAttempts: 0, blockedUntil: 0 });
            window.location.href = "/profiles/" + username + ".html"; // تحويل للصفحة الشخصية
        } else {
            let attempts = (data.loginAttempts || 0) + 1;
            let blockedUntil = 0;

            if (attempts === 3) {
                blockedUntil = now + (30 * 60 * 1000); // حظر 30 دقيقة
                attempts = 0;
                alert("تم حظرك 30 دقيقة");
            } else if (attempts > 3) {
                blockedUntil = now + (24 * 60 * 60 * 1000); // حظر 24 ساعة
                attempts = 0;
                alert("تم حظرك 24 ساعة");
            } else {
                alert("كلمة المرور خاطئة. المحاولات المتبقية: " + (3 - attempts));
            }

            userRef.update({ loginAttempts: attempts, blockedUntil: blockedUntil });
        }
    });
}
</script>
</body>
</html>
