<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
</head>
<body>
<h1>تسجيل الدخول</h1>
<input type="text" id="username" placeholder="اسم المستخدم"><br><br>
<input type="password" id="password" placeholder="كلمة المرور"><br><br>
<button onclick="login()">دخول</button>

<script>
const firebaseConfig = {
    apiKey: "ضع هنا API Key الخاص بك",
    authDomain: "ضع هنا Auth Domain",
    databaseURL: "ضع هنا Database URL",
    projectId: "ضع هنا Project ID",
    storageBucket: "ضع هنا Storage Bucket",
    messagingSenderId: "ضع هنا Messaging Sender ID",
    appId: "ضع هنا App ID"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function login() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    const userRef = db.ref("Users/" + username);
    userRef.once("value").then(snapshot => {
        if (!snapshot.exists()) {
            alert("المستخدم غير موجود");
            return;
        }

        const data = snapshot.val();
        const now = Date.now();

        if (now < (data.blockedUntil || 0)) {
            alert("أنت محظور حتى " + new Date(data.blockedUntil));
            return;
        }

        if (data.password === password) {
            userRef.update({ loginAttempts: 0, blockedUntil: 0 });
            window.location.href = "/profiles/" + username + ".html";
        } else {
            let attempts = (data.loginAttempts || 0) + 1;
            let blockedUntil = 0;

            if (attempts === 3) {
                blockedUntil = now + (30 * 60 * 1000); // 30 دقيقة
                attempts = 0;
                alert("تم حظرك 30 دقيقة");
            } else if (attempts > 3) {
                blockedUntil = now + (24 * 60 * 60 * 1000); // 24 ساعة
                attempts = 0;
                alert("تم حظرك 24 ساعة");
            } else {
                alert("كلمة المرور خاطئة. المحاولات المتبقية: " + (3 - attempts));
            }

            userRef.update({ loginAttempts: attempts, blockedUntil: blockedUntil });
        }
    });
}
</script>
</body>
</html>
